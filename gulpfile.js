//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////
var gulp          = require('gulp'),
  coffee          = require('gulp-coffee'),
  jshint          = require('gulp-jshint'),
  rename          = require('gulp-rename'),
  clean           = require('gulp-clean'),
  concat          = require('gulp-concat');

//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////
gulp.task('scripts', function() {
  return gulp.src(['app/server/**/*.coffee'])
    .pipe(coffee())
    .pipe(gulp.dest('deploy'))
});

//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////

gulp.task('mongroup', function(){
  return gulp.src('app/server/mongroup.*')
    .pipe(gulp.dest('deploy'))
});
gulp.task('json', function(){
  return gulp.src('app/server/*.json')
    .pipe(gulp.dest('deploy'))
});

gulp.task('resources', function() {
  return gulp.start(['mongroup','json']);
});

//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////
gulp.task('watch', ['clean'], function() {
  gulp.start('scripts','resources');

  // Watch Scripts
  gulp.watch(['app/**/*.coffee'], ['scripts']);
  // Watch Resources
  gulp.watch('app/server/nodemon.json', ['nodemon']);
});


//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////
gulp.task('clean', function() {
    return gulp.src(['deploy/*'], {read: false})
    .pipe(clean());
});

//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////
gulp.task('build',['clean'], function() {
    return gulp.start('scripts','resources');
});
